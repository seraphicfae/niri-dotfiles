#!/usr/bin/env bash

wallpaper_folder="$HOME/Pictures/wallpapers"
index_tracker="$HOME/.local/state/wallpaper_index"
active_wallpaper="$HOME/.local/state/current_wallpaper"

mapfile -t wallpaper_list < <(find "$wallpaper_folder" -type f \( -iname '*.png' -o -iname '*.jpg' -o -iname '*.jpeg' -o -iname '*.gif' \) | sort)
[[ ${#wallpaper_list[@]} -eq 0 ]] && exit 1

current_index=$(cat "$index_tracker" 2>/dev/null)
[[ ! "$current_index" =~ ^[0-9]+$ ]] && current_index=0

next_index=$(( (current_index + 1) % ${#wallpaper_list[@]} ))

styles=("grow" "outer" "wipe" "wave")
positions=("center" "top" "bottom" "left" "right" "top-left" "top-right" "bottom-left" "bottom-right")
waves=("20,20" "30,15" "25,25" "40,10")

ln -sf "${wallpaper_list[$next_index]}" "$active_wallpaper"
matugen image "$active_wallpaper"
echo "$next_index" > "$index_tracker"

awww img "$active_wallpaper" \
    --transition-type "${styles[$RANDOM % ${#styles[@]}]}" \
    --transition-pos "${positions[$RANDOM % ${#positions[@]}]}" \
    --transition-wave "${waves[$RANDOM % ${#waves[@]}]}" \
    --transition-duration "1.5" \
    --transition-fps "60" \
    --transition-angle "$(( RANDOM % 360 ))"
