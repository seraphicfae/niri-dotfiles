#!/usr/bin/env bash
# Creator : Faye | https://github.com/seraphicfae/niri-dotfiles

target_file="$HOME/.local/share/icons/face.png"
input_image="$1"

if [[ -z "$input_image" ]]; then
    input_image=$(zenity --file-selection --title="Select Profile Picture" --file-filter="Images | *.png *.jpg *.jpeg *.webp *.gif")

    if [[ -z "$input_image" ]]; then
        echo "No file selected. Exiting."
        exit 0
    fi
fi

absolute_file_path=$(realpath "$input_image")

if magick "$absolute_file_path" \
  -gravity center -extent 1:1 \
  -resize 512x512 \
  \( -size 512x512 xc:black -fill white -draw "circle 256,256 256,1" \) \
  -alpha off -compose copy_opacity -composite \
  "$target_file"; then

    echo "Successfully updated profile picture at $target_file"
    notify-send "Profile Updated" "Your new avatar is ready." -i "$target_file"
else
    echo "Error: ImageMagick failed to process the image."
    exit 1
fi
